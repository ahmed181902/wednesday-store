<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>لوحة تحكم متطورة | Advanced Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- خطوط وأيقونات -->
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@500;700&display=swap" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" rel="stylesheet">
  <style>
    :root {
      --main: #23272e;
      --gold: #ffd700;
      --white: #fff;
      --gray: #f8f9fa;
      --dark: #222;
      --accent: #e74c3c;
      --success: #27ae60;
      --radius: 14px;
      --transition: 0.2s;
      --font: 'Cairo', Arial, sans-serif;
    }
    body {
      font-family: var(--font);
      background: var(--gray);
      margin: 0;
      color: var(--dark);
      direction: rtl;
      min-height: 100vh;
    }
    .dashboard {
      display: flex;
      min-height: 100vh;
    }
    .sidebar {
      width: 230px;
      background: var(--main);
      color: var(--white);
      padding: 32px 0 0 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
      box-shadow: 2px 0 8px rgba(35,39,46,0.08);
    }
    .sidebar .logo {
      font-size: 1.5rem;
      font-weight: bold;
      margin-bottom: 36px;
      letter-spacing: 1px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .sidebar .logo svg {
      width: 32px; height: 32px;
      background: var(--gold);
      border-radius: 50%;
      padding: 4px;
    }
    .sidebar nav {
      display: flex;
      flex-direction: column;
      gap: 16px;
      width: 100%;
    }
    .sidebar nav button {
      background: none;
      border: none;
      color: var(--white);
      font-size: 1.1rem;
      padding: 12px 0 12px 24px;
      text-align: right;
      width: 100%;
      cursor: pointer;
      transition: background 0.2s;
      border-right: 4px solid transparent;
    }
    .sidebar nav button.active, .sidebar nav button:hover {
      background: var(--gold);
      color: var(--main);
      border-right: 4px solid var(--accent);
    }
    .sidebar .lang-btn {
      margin-top: 60px;
      background: var(--gold);
      color: var(--main);
      border: none;
      border-radius: 8px;
      padding: 8px 20px;
      font-weight: bold;
      font-size: 1rem;
      cursor: pointer;
      transition: background 0.2s;
    }
    .main-content {
      flex: 1;
      padding: 36px 24px;
      background: var(--gray);
      min-height: 100vh;
      position: relative;
    }
    .topbar {
      display: flex;
      justify-content: flex-end;
      align-items: center;
      gap: 16px;
      margin-bottom: 28px;
    }
    .topbar .user {
      background: var(--gold);
      color: var(--main);
      padding: 7px 18px;
      border-radius: 20px;
      font-weight: bold;
      font-size: 1.05rem;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .topbar .logout {
      background: var(--accent);
      color: #fff;
      border: none;
      border-radius: 8px;
      padding: 7px 18px;
      font-size: 1rem;
      cursor: pointer;
      margin-right: 8px;
    }
    .section-title {
      font-size: 1.4rem;
      color: var(--main);
      margin-bottom: 22px;
      border-right: 5px solid var(--gold);
      padding-right: 10px;
      font-weight: bold;
    }
    .products-table {
      width: 100%;
      border-collapse: collapse;
      background: #fff;
      border-radius: 10px;
      overflow: hidden;
      box-shadow: 0 2px 12px rgba(35,39,46,0.07);
    }
    .products-table th, .products-table td {
      padding: 12px 10px;
      border-bottom: 1px solid #eee;
      text-align: center;
      font-size: 1.05rem;
    }
    .products-table th {
      background: var(--gray);
      color: var(--main);
    }
    .products-table img {
      width: 46px; height: 46px;
      border-radius: 8px;
      object-fit: cover;
      border: 1px solid #eee;
    }
    .add-btn {
      background: var(--success);
      color: #fff;
      border: none;
      border-radius: 8px;
      padding: 10px 22px;
      font-size: 1.1rem;
      font-weight: bold;
      cursor: pointer;
      margin-bottom: 18px;
      margin-top: 8px;
      transition: background 0.2s;
    }
    .add-btn:hover { background: var(--main); color: var(--gold);}
    .edit-btn, .del-btn {
      background: var(--main);
      color: #fff;
      border: none;
      border-radius: 6px;
      padding: 5px 14px;
      font-size: 1rem;
      cursor: pointer;
      margin: 0 3px;
      transition: background 0.2s;
    }
    .edit-btn:hover { background: var(--gold); color: var(--main);}
    .del-btn { background: var(--accent);}
    .del-btn:hover { background: #a93226;}
    .modal {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.25);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
    }
    .modal-content {
      background: #fff;
      border-radius: 14px;
      padding: 32px 28px;
      min-width: 340px;
      max-width: 98vw;
      box-shadow: 0 2px 24px rgba(0,0,0,0.13);
      position: relative;
    }
    .modal-content label { display: block; margin: 14px 0 5px 0; }
    .modal-content input, .modal-content select, .modal-content textarea {
      width: 100%; padding: 8px; border-radius: 7px; border: 1px solid #ccc; margin-bottom: 6px; font-size: 1rem;
    }
    .modal-content .img-preview {
      width: 70px; height: 70px; object-fit: cover; border-radius: 8px; border: 1px solid #eee; margin-bottom: 8px;
      display: block;
    }
    .close-modal {
      position: absolute; top: 12px; left: 18px;
      background: none; border: none; font-size: 1.2rem; color: #888; cursor: pointer;
    }
    .success-msg, .error-msg {
      margin: 12px 0 0 0; padding: 10px; border-radius: 8px; font-weight: bold;
    }
    .success-msg { background: #eafaf1; color: #27ae60;}
    .error-msg { background: #fdecea; color: #e74c3c;}
    @media (max-width: 900px) {
      .dashboard { flex-direction: column;}
      .sidebar { width: 100%; min-height: unset; flex-direction: row; justify-content: space-between; padding: 16px 0;}
      .main-content { padding: 18px 5px;}
    }
  </style>
</head>
<body>
<div class="dashboard">
  <div class="sidebar">
    <div class="logo">
      <svg viewBox="0 0 48 48"><circle cx="24" cy="24" r="22" fill="#fff"/><rect x="14" y="14" width="20" height="20" rx="6" fill="#23272e"/><rect x="20" y="32" width="8" height="3" rx="1.5" fill="#ffd700"/></svg>
      <span id="dashLogo">Wednesday Store</span>
    </div>
    <nav>
      <button id="navProducts" class="active"><i class="fas fa-box"></i> <span id="navProductsTxt"></span></button>
      <button id="navCats"><i class="fas fa-tags"></i> <span id="navCatsTxt"></span></button>
      <button id="navSettings"><i class="fas fa-cog"></i> <span id="navSettingsTxt"></span></button>
    </nav>
    <button class="lang-btn" onclick="switchLang()"></button>
  </div>
  <div class="main-content" id="mainContent">
    <!-- سيتم تعبئة المحتوى ديناميكياً -->
  </div>
</div>
<script>
const texts = {
  ar: {
    products: "المنتجات",
    categories: "التصنيفات",
    settings: "الإعدادات",
    addProduct: "إضافة منتج",
    editProduct: "تعديل المنتج",
    del: "حذف",
    edit: "تعديل",
    nameAr: "اسم المنتج (عربي)",
    nameEn: "اسم المنتج (إنجليزي)",
    descAr: "وصف المنتج (عربي)",
    descEn: "وصف المنتج (إنجليزي)",
    category: "التصنيف",
    price: "السعر الأساسي",
    sale: "سعر العرض (اختياري)",
    onSale: "تفعيل السعر المشطوب",
    latestOffer: "أحدث العروض",
    wednesdayOffer: "عروض الأربعاء",
    img: "صورة المنتج",
    save: "حفظ",
    cancel: "إلغاء",
    actions: "إجراءات",
    imgPreview: "معاينة الصورة",
    addCat: "إضافة تصنيف",
    catNameAr: "اسم التصنيف (عربي)",
    catNameEn: "اسم التصنيف (إنجليزي)",
    saveCat: "حفظ التصنيف",
    delCat: "حذف التصنيف",
    settingsTitle: "إعدادات الإدارة",
    adminPass: "كلمة مرور الإدارة",
    newPass: "كلمة مرور جديدة",
    changePass: "تغيير كلمة المرور",
    logo: "تغيير الشعار",
    lang: "English",
    logout: "خروج",
    user: "مدير المتجر",
    required: "كل الحقول مطلوبة!",
    saved: "تم الحفظ بنجاح!",
    deleted: "تم الحذف!",
    confirmDel: "تأكيد الحذف؟"
  },
  en: {
    products: "Products",
    categories: "Categories",
    settings: "Settings",
    addProduct: "Add Product",
    editProduct: "Edit Product",
    del: "Delete",
    edit: "Edit",
    nameAr: "Product Name (Arabic)",
    nameEn: "Product Name (English)",
    descAr: "Description (Arabic)",
    descEn: "Description (English)",
    category: "Category",
    price: "Base Price",
    sale: "Sale Price (optional)",
    onSale: "Enable Strikethrough Price",
    latestOffer: "Latest Offers",
    wednesdayOffer: "Wednesday Offers",
    img: "Product Image",
    save: "Save",
    cancel: "Cancel",
    actions: "Actions",
    imgPreview: "Image Preview",
    addCat: "Add Category",
    catNameAr: "Category Name (Arabic)",
    catNameEn: "Category Name (English)",
    saveCat: "Save Category",
    delCat: "Delete Category",
    settingsTitle: "Admin Settings",
    adminPass: "Admin Password",
    newPass: "New Password",
    changePass: "Change Password",
    logo: "Change Logo",
    lang: "العربية",
    logout: "Logout",
    user: "Store Admin",
    required: "All fields are required!",
    saved: "Saved successfully!",
    deleted: "Deleted!",
    confirmDel: "Are you sure to delete?"
  }
};

let currentLang = localStorage.getItem('dashLang') || 'ar';
function switchLang() {
  currentLang = currentLang === 'ar' ? 'en' : 'ar';
  localStorage.setItem('dashLang', currentLang);
  renderSidebar();
  renderMain();
}

// بيانات التصنيفات
let cats = JSON.parse(localStorage.getItem('ws_dash_cats') || '[]');
if (cats.length === 0) {
  cats = [
    {ar: "إلكترونيات", en: "Electronics"},
    {ar: "كفرات", en: "Covers"},
    {ar: "جيمنج", en: "Gaming"},
    {ar: "جوال", en: "Mobile"}
  ];
  localStorage.setItem('ws_dash_cats', JSON.stringify(cats));
}

// بيانات المنتجات
let products = JSON.parse(localStorage.getItem('ws_dash_products') || '[]');
if (products.length === 0) {
  products = [
    {
      name: {ar: "جراب آيفون 14", en: "iPhone 14 Case"},
      desc: {ar: "جراب حماية عالي الجودة.", en: "High quality protective case."},
      cat: "كفرات",
      price: 200,
      sale: 150,
      onSale: true,
      latestOffer: true,
      wednesdayOffer: false,
      img: "",
    }
  ];
  localStorage.setItem('ws_dash_products', JSON.stringify(products));
}

let currentSection = "products";

function renderSidebar() {
  document.getElementById('navProducts').className = currentSection === "products" ? "active" : "";
  document.getElementById('navCats').className = currentSection === "cats" ? "active" : "";
  document.getElementById('navSettings').className = currentSection === "settings" ? "active" : "";
  document.getElementById('navProductsTxt').textContent = texts[currentLang].products;
  document.getElementById('navCatsTxt').textContent = texts[currentLang].categories;
  document.getElementById('navSettingsTxt').textContent = texts[currentLang].settings;
  document.querySelector('.lang-btn').textContent = texts[currentLang].lang;
  document.getElementById('dashLogo').textContent = "Wednesday Store";
}
renderSidebar();

document.getElementById('navProducts').onclick = ()=>{currentSection="products";renderSidebar();renderMain();};
document.getElementById('navCats').onclick = ()=>{currentSection="cats";renderSidebar();renderMain();};
document.getElementById('navSettings').onclick = ()=>{currentSection="settings";renderSidebar();renderMain();};

function renderMain() {
  let html = `<div class="topbar">
    <span class="user"><i class="fas fa-user"></i> ${texts[currentLang].user}</span>
    <button class="logout" onclick="logout()">${texts[currentLang].logout}</button>
  </div>`;
  if (currentSection === "products") {
    html += `<div class="section-title">${texts[currentLang].products}</div>
      <button class="add-btn" onclick="showProductModal()"><i class="fas fa-plus"></i> ${texts[currentLang].addProduct}</button>
      <div style="overflow-x:auto;">
      <table class="products-table">
        <tr>
          <th>#</th>
          <th>${texts[currentLang].imgPreview}</th>
          <th>${texts[currentLang].nameAr}<br>${texts[currentLang].nameEn}</th>
          <th>${texts[currentLang].category}</th>
          <th>${texts[currentLang].price}</th>
          <th>${texts[currentLang].sale}</th>
          <th>${texts[currentLang].latestOffer}</th>
          <th>${texts[currentLang].wednesdayOffer}</th>
          <th>${texts[currentLang].actions}</th>
        </tr>
        ${products.map((p,i)=>`
          <tr>
            <td>${i+1}</td>
            <td>${p.img?`<img src="${p.img}">`:"-"}</td>
            <td>${p.name.ar}<br><span style="color:#888">${p.name.en}</span></td>
            <td>${p.cat}</td>
            <td>${p.price}</td>
            <td>${p.sale && p.sale<p.price? `<span style="color:#27ae60">${p.sale}</span>`:"-"}</td>
            <td>${p.latestOffer?"✔️":""}</td>
            <td>${p.wednesdayOffer?"✔️":""}</td>
            <td>
              <button class="edit-btn" onclick="showProductModal(${i})">${texts[currentLang].edit}</button>
              <button class="del-btn" onclick="deleteProduct(${i})">${texts[currentLang].del}</button>
            </td>
          </tr>
        `).join('')}
      </table>
      </div>`;
  }
  if (currentSection === "cats") {
    html += `<div class="section-title">${texts[currentLang].categories}</div>
      <button class="add-btn" onclick="showCatModal()"><i class="fas fa-plus"></i> ${texts[currentLang].addCat}</button>
      <table class="products-table">
        <tr>
          <th>#</th>
          <th>${texts[currentLang].catNameAr}</th>
          <th>${texts[currentLang].catNameEn}</th>
          <th>${texts[currentLang].actions}</th>
        </tr>
        ${cats.map((c,i)=>`
          <tr>
            <td>${i+1}</td>
            <td>${c.ar}</td>
            <td>${c.en}</td>
            <td>
              <button class="del-btn" onclick="deleteCat(${i})">${texts[currentLang].delCat}</button>
            </td>
          </tr>
        `).join('')}
      </table>`;
  }
  if (currentSection === "settings") {
    html += `<div class="section-title">${texts[currentLang].settingsTitle}</div>
      <form onsubmit="changePass(event)">
        <label>${texts[currentLang].newPass}</label>
        <input type="password" id="newPass" required>
        <button class="add-btn" style="margin-top:12px;">${texts[currentLang].changePass}</button>
      </form>`;
  }
  document.getElementById('mainContent').innerHTML = html;
}

// --- المنتجات ---
function showProductModal(idx) {
  let p = idx!=null ? products[idx] : {
    name: {ar:"",en:""}, desc:{ar:"",en:""}, cat:cats[0]?cats[0].ar:"", price:"", sale:"", onSale:false, latestOffer:false, wednesdayOffer:false, img:""
  };
  let isEdit = idx!=null;
  let modal = document.createElement('div');
  modal.className = "modal";
  modal.innerHTML = `<div class="modal-content">
    <button class="close-modal" onclick="this.closest('.modal').remove()">&times;</button>
    <h3>${isEdit?texts[currentLang].editProduct:texts[currentLang].addProduct}</h3>
    <label>${texts[currentLang].nameAr}</label>
    <input id="pnameAr" value="${p.name.ar||""}" required>
    <label>${texts[currentLang].nameEn}</label>
    <input id="pnameEn" value="${p.name.en||""}" required>
    <label>${texts[currentLang].descAr}</label>
    <textarea id="pdescAr">${p.desc.ar||""}</textarea>
    <label>${texts[currentLang].descEn}</label>
    <textarea id="pdescEn">${p.desc.en||""}</textarea>
    <label>${texts[currentLang].category}</label>
    <select id="pcat">${cats.map(c=>`<option${p.cat===c.ar?' selected':''}>${c.ar}</option>`).join('')}</select>
    <label>${texts[currentLang].price}</label>
    <input type="number" id="pprice" value="${p.price||""}" required>
    <label>${texts[currentLang].sale}</label>
    <input type="number" id="psale" value="${p.sale||""}">
    <label><input type="checkbox" id="ponSale" ${p.onSale?'checked':''}> ${texts[currentLang].onSale}</label>
    <label><input type="checkbox" id="platest" ${p.latestOffer?'checked':''}> ${texts[currentLang].latestOffer}</label>
    <label><input type="checkbox" id="pwednesday" ${p.wednesdayOffer?'checked':''}> ${texts[currentLang].wednesdayOffer}</label>
    <label>${texts[currentLang].img}</label>
    <input type="file" id="pimg" accept="image/*">
    <img id="imgPreview" class="img-preview" src="${p.img||''}" style="display:${p.img?'block':'none'}">
    <div id="modalMsg"></div>
    <button class="add-btn" onclick="saveProduct(${isEdit?idx:''})">${texts[currentLang].save}</button>
    <button class="edit-btn" onclick="this.closest('.modal').remove()">${texts[currentLang].cancel}</button>
  </div>`;
  document.body.appendChild(modal);
  document.getElementById('pimg').onchange = function(e){
    let file = e.target.files[0];
    if (!file) return;
    let reader = new FileReader();
    reader.onload = function(ev){
      document.getElementById('imgPreview').src = ev.target.result;
      document.getElementById('imgPreview').style.display = "block";
    };
    reader.readAsDataURL(file);
  }
}

function saveProduct(idx) {
  let nameAr = document.getElementById('pnameAr').value.trim();
  let nameEn = document.getElementById('pnameEn').value.trim();
  let descAr = document.getElementById('pdescAr').value.trim();
  let descEn = document.getElementById('pdescEn').value.trim();
  let cat = document.getElementById('pcat').value;
  let price = +document.getElementById('pprice').value;
  let sale = +document.getElementById('psale').value || price;
  let onSale = document.getElementById('ponSale').checked;
  let latestOffer = document.getElementById('platest').checked;
  let wednesdayOffer = document.getElementById('pwednesday').checked;
  let img = document.getElementById('imgPreview').src || "";
  if (!nameAr || !nameEn || !descAr || !descEn || !cat || !price) {
    showModalMsg(texts[currentLang].required, false);
    return;
  }
  let prod = {name:{ar:nameAr,en:nameEn},desc:{ar:descAr,en:descEn},cat,price,sale,onSale,latestOffer,wednesdayOffer,img};
  if (idx!=null) products[idx]=prod;
  else products.push(prod);
  localStorage.setItem('ws_dash_products', JSON.stringify(products));
  showModalMsg(texts[currentLang].saved, true);
  setTimeout(()=>{document.querySelector('.modal').remove();renderMain();}, 800);
}
function showModalMsg(msg, success) {
  let d = document.getElementById('modalMsg');
  d.innerHTML = `<div class="${success?'success-msg':'error-msg'}">${msg}</div>`;
}
function deleteProduct(idx) {
  if (!confirm(texts[currentLang].confirmDel)) return;
  products.splice(idx,1);
  localStorage.setItem('ws_dash_products', JSON.stringify(products));
  renderMain();
}

// --- التصنيفات ---
function showCatModal() {
  let modal = document.createElement('div');
  modal.className = "modal";
  modal.innerHTML = `<div class="modal-content">
    <button class="close-modal" onclick="this.closest('.modal').remove()">&times;</button>
    <h3>${texts[currentLang].addCat}</h3>
    <label>${texts[currentLang].catNameAr}</label>
    <input id="catAr" required>
    <label>${texts[currentLang].catNameEn}</label>
    <input id="catEn" required>
    <div id="modalMsg"></div>
    <button class="add-btn" onclick="saveCat()">${texts[currentLang].saveCat}</button>
    <button class="edit-btn" onclick="this.closest('.modal').remove()">${texts[currentLang].cancel}</button>
  </div>`;
  document.body.appendChild(modal);
}
function saveCat() {
  let ar = document.getElementById('catAr').value.trim();
  let en = document.getElementById('catEn').value.trim();
  if (!ar || !en) { showModalMsg(texts[currentLang].required, false); return; }
  cats.push({ar,en});
  localStorage.setItem('ws_dash_cats', JSON.stringify(cats));
  showModalMsg(texts[currentLang].saved, true);
  setTimeout(()=>{document.querySelector('.modal').remove();renderMain();}, 800);
}
function deleteCat(idx) {
  if (!confirm(texts[currentLang].confirmDel)) return;
  cats.splice(idx,1);
  localStorage.setItem('ws_dash_cats', JSON.stringify(cats));
  renderMain();
}

// --- الإعدادات ---
function changePass(e) {
  e.preventDefault();
  let np = document.getElementById('newPass').value.trim();
  if (!np) return alert(texts[currentLang].required);
  localStorage.setItem('ws_admin_pass', np);
  alert(texts[currentLang].saved);
  document.getElementById('newPass').value = "";
}

// --- تسجيل الخروج ---
function logout() {
  window.location.href = "/";
}

renderMain();
</script>
</body>
</html>
